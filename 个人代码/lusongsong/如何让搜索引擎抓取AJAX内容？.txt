<dl class="post-content" id="post-1445"><div class="post-title"> <h1><a href="http://lusongsong.com/info/post/487.html" rel="bookmark">如何让搜索引擎抓取AJAX内容？</a></h1> <h6><a href="#comment"><span class="commentViewNums"><script>var nbcacheviewtemp=Math.floor(Math.random()*9999);</script><nbcache id="nbcache3653"></nbcache><script type="text/javascript">$("#nbcache3653").attr("id","nbcache3653"+nbcacheviewtemp);Nobird_Cache_AddViewNums(7983,3653,nbcacheviewtemp)</script></span></a> 人参与 | 时间：2013年07月16日 16:12 <div id="ckepop"></div></h6> </div> <div class="clear"></div> <dd class="con"> <p>越来越多的网站，开始采用"<a href="http://lusongsong.com/info/post/463.html" target="_blank">单页面结构</a>"(Single-page application)。<br></p><p>整个网站只有一张网页，采用Ajax技术，根据用户的输入，加载不同的内容。</p><p style="text-align:center;"><img alt="如何让搜索引擎抓取AJAX内容？ 好文分享 第1张" title="如何让搜索引擎抓取AJAX内容？ 好文分享 第1张" src="http://images.lusongsong.com/upload/info/487-1.jpg" width="399" height="500"></p><p>这种做法的好处是用户体验好、节省流量，缺点是AJAX内容无法被搜索引擎抓取。举例来说，你有一个网站。</p><blockquote><p>http://example.com</p></blockquote><p>用户通过井号结构的URL，看到不同的内容。</p><blockquote><p>http://example.com#1</p><p>http://example.com#2</p><p>http://example.com#3</p></blockquote><p>但是，搜索引擎只抓取example.com，不会理会井号，因此也就无法索引内容。</p><p>为了解决这个问题，Google提出了"井号+感叹号"的结构。</p><blockquote><p>http://example.com#!1</p></blockquote><p>当Google发现上面这样的URL，就自动抓取另一个网址：</p><blockquote><p>http://example.com/?_escaped_fragment_=1</p></blockquote><p>只要你把AJAX内容放在这个网址，Google就会收录。但是问题是，"井号+感叹号"非常难看且烦琐。Twitter曾经采用这种结构，它把</p><blockquote><p>http://twitter.com/ruanyf</p></blockquote><p>改成</p><blockquote><p>http://twitter.com/#!/ruanyf</p></blockquote><p>结果用户抱怨连连，只用了半年就废除了。</p><p>那么，有没有什么方法，可以在保持比较直观的URL的同时，还让搜索引擎能够抓取AJAX内容?</p><p>我一直以为没有办法做到，直到前两天看到了Discourse创始人之一的Robin Ward的解决方法，不禁拍案叫绝。</p><p style="text-align:center;"><img alt="如何让搜索引擎抓取AJAX内容？ 好文分享 第2张" title="如何让搜索引擎抓取AJAX内容？ 好文分享 第2张" src="http://images.lusongsong.com/upload/info/487-2.png" width="400" height="261"></p><p>Discourse是一个论坛程序，严重依赖Ajax，但是又必须让Google收录内容。它的解决方法就是放弃井号结构，采用 History API。</p><p>所谓 History API，指的是不刷新页面的情况下，改变浏览器地址栏显示的URL(准确说，是改变网页的当前状态)。这里有<a target="_blank" rel="external nofollow" href="http://inserthtml.com/demo/history/">一个例子</a>，你点击上方的按钮，开始播放音乐。然后，再点击下面的链接，看看发生了什么事?</p><p style="text-align:center"><img alt="如何让搜索引擎抓取AJAX内容？ 好文分享 第3张" title="如何让搜索引擎抓取AJAX内容？ 好文分享 第3张" src="http://images.lusongsong.com/upload/info/487-3.png" width="450" height="331"></p><p>地址栏的URL变了，但是音乐播放没有中断!</p><p>History API 的详细介绍，超出这篇文章的范围。这里只简单说，它的作用就是在浏览器的History对象中，添加一条记录。</p><blockquote><p>window.history.pushState(state object, title, url);</p></blockquote><p>上面这行命令，可以让地址栏出现新的URL。History对象的pushState方法接受三个参数，新的URL就是第三个参数，前两个参数都可以是null。</p><blockquote><p>window.history.pushState(null, null, newURL);</p></blockquote><p>目前，各大浏览器都支持这个方法：Chrome(26.0+)，Firefox(20.0+)，IE(10.0+)，Safari(5.1+)，Opera(12.1+)。</p><p>下面就是Robin Ward的方法。</p><p><strong>首先，用History API替代井号结构，让每个井号都变成正常路径的URL，这样搜索引擎就会抓取每一个网页。</strong></p><blockquote><p>example.com/1</p><p>example.com/2</p><p>example.com/3</p></blockquote><p><strong>然后，定义一个JavaScript函数，处理Ajax部分，根据网址抓取内容(假定使用jQuery)。</strong></p><blockquote><p>function anchorClick(link) {</p><p>var linkSplit = link.split('/').pop();</p><p>$.get('api/' + linkSplit, function(data) {</p><p>$('#content').html(data);</p><p>});</p><p>}</p></blockquote><p>再定义鼠标的click事件。</p><blockquote><p>$('#container').on('click', 'a', function(e) {</p><p>window.history.pushState(null, null, $(this).attr('href'));</p><p>anchorClick($(this).attr('href'));</p><p>e.preventDefault();</p><p>});</p></blockquote><p>还要考虑到用户点击浏览器的"前进 / 后退"按钮。这时会触发History对象的popstate事件。</p><blockquote><p>window.addEventListener('popstate', function(e) {</p><p>anchorClick(location.pathname);</p><p>});</p></blockquote><p>定义完上面三段代码，就能在不刷新页面的情况下，显示正常路径URL和AJAX内容。</p><p><strong>最后，设置服务器端。</strong></p><p>因为不使用井号结构，每个URL都是一个不同的请求。所以，要求服务器端对所有这些请求，都返回如下结构的网页，防止出现404错误。</p><blockquote><p>　　&lt;html&gt;</p><p>　　　　&lt;body&gt;</p><p>　　　　　　&lt;section id='container'&gt;&lt;/section&gt;</p><p>　　　　　　&lt;noscript&gt;</p><p>　　　　　　　　... ...</p><p>　　　　　　&lt;/noscript&gt;</p><p>　　　　&lt;/body&gt;</p><p>　　&lt;/html&gt;</p></blockquote><p>仔细看上面这段代码，你会发现有一个noscript标签，这就是奥妙所在。</p><p>我们把所有要让搜索引擎收录的内容，都放在noscript标签之中。这样的话，用户依然可以执行AJAX操作，不用刷新页面，但是搜索引擎会收录每个网页的主要内容!</p><p>(完)</p><p>文章来源：<a target="_blank" rel="external nofollow" href="http://www.ruanyifeng.com/blog/2013/07/how_to_make_search_engines_find_ajax_content.html">阮一峰的网络日志</a></p><ins class="kandyDiggLog"><span class="diggUp">顶: <ins data-digg="3653">0</ins></span><span class="diggDn">踩: <ins data-digg="3653">0</ins></span></ins> <p id="comment">来源：<a rel="author" href="http://lusongsong.com/info/post/487.html" title="卢松松博客">卢松松博客</a>，欢迎分享，（QQ/微信：13340454）</p> <div id="wenad"> <center> <script>
(function() {
    var s = "_" + Math.random().toString(36).slice(2);
    document.write('<div id="' + s + '"></div>');
    (window.slotbydup=window.slotbydup || []).push({
        id: '2398783',
        container: s,
        size: '336,280',
        display: 'inlay-fix'
    });
})();
</script></center> </div> </dd> </dl>